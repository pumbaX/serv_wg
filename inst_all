#!/bin/bash

# Script: install_all.sh
# Desc: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç amnezia.sh –∏ docker-install.sh –ø–æ –ø–æ—Ä—è–¥–∫—É

set -e  # –í—ã—Ö–æ–¥ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "=== –£–°–¢–ê–ù–û–í–ö–ê AMNEZIA + DOCKER ==="
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ root
if [[ $EUID -ne 0 ]]; then
    echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ root. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ sudo!"
    exit 1
fi

# 2. –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
TEMP_DIR="/tmp/wg_install_$(date +%s)"
mkdir -p "$TEMP_DIR"
cd "$TEMP_DIR"

echo "üìÅ –†–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞: $TEMP_DIR"
echo ""

# 3. –°–∫–∞—á–∏–≤–∞–µ–º amnezia.sh
echo "üîΩ –°–∫–∞—á–∏–≤–∞—é amnezia.sh..."
if wget -q https://raw.githubusercontent.com/pumbaX/serv_wg/main/amnezia.sh; then
    chmod +x amnezia.sh
    echo "‚úÖ amnezia.sh —Å–∫–∞—á–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ amnezia.sh"
    exit 1
fi

# 4. –°–∫–∞—á–∏–≤–∞–µ–º docker-install.sh
echo "üîΩ –°–∫–∞—á–∏–≤–∞—é docker-install.sh..."
if wget -q https://raw.githubusercontent.com/pumbaX/serv_wg/main/docker-install.sh; then
    chmod +x docker-install.sh
    echo "‚úÖ docker-install.sh —Å–∫–∞—á–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ docker-install.sh"
    exit 1
fi

echo ""
echo "========================================"
echo "1. –°–ù–ê–ß–ê–õ–ê –ë–£–î–ï–¢ –£–°–¢–ê–ù–û–í–õ–ï–ù DOCKER"
echo "2. –ó–ê–¢–ï–ú –ë–£–î–ï–¢ –£–°–¢–ê–ù–û–í–õ–ï–ù–ê AMNEZIA/WIREGUARD"
echo "========================================"
echo ""

# 5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É? (y/N): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞. –°–∫—Ä–∏–ø—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ $TEMP_DIR"
    exit 0
fi

# 6. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Docker –ü–ï–†–í–´–ú (—ç—Ç–æ –≤–∞–∂–Ω–æ!)
echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é —É—Å—Ç–∞–Ω–æ–≤–∫—É Docker..."
echo "----------------------------------------"
./docker-install.sh

echo ""
echo "‚úÖ Docker —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
echo ""

# 7. –ü–∞—É–∑–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Docker
read -p "Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π Amnezia? (y/N): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∑–∞–≤–µ—Ä—à–µ–Ω–∞. Amnezia –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞."
    exit 0
fi

# 8. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Amnezia
echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é —É—Å—Ç–∞–Ω–æ–≤–∫—É Amnezia..."
echo "----------------------------------------"
./amnezia.sh

echo ""
echo "========================================"
echo "üéâ –í–°–Å –£–°–¢–ê–ù–û–í–õ–ï–ù–û!"
echo "========================================"
echo "–°–∫—Ä–∏–ø—Ç—ã –æ—Å—Ç–∞–ª–∏—Å—å –≤: $TEMP_DIR"
